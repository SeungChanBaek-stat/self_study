# 접합점 전 구간: x < 4
x_min <- min(x)    # 예: 1
x_knot <- 4
y_min <- beta_hat_2[1] + beta_hat_2[2] * x_min
y_knot <- beta_hat_2[1] + beta_hat_2[2] * x_knot
segments(x_min, y_min, x_knot, y_knot, col = "blue", lwd = 2)
# 접합점 후 구간: x >= 4
x_max <- max(x)    # 예: 10
# x>=4인 구간의 회귀식은 y = beta_hat_2[1] + beta_hat_2[2]*x + beta_hat_2[3]*(x - 4)
y_knot2 <- beta_hat_2[1] + beta_hat_2[2] * x_knot  # x=4에서의 y값 (두 식이 같아야 함)
y_max <- beta_hat_2[1] + beta_hat_2[2] * x_max + beta_hat_2[3] * (x_max - 4)
segments(x_knot, y_knot2, x_max, y_max, col = "blue", lwd = 2)
curve(ifelse(x < 4,
beta_hat_3[1] + beta_hat_3[2] * x,
beta_hat_3[1] + beta_hat_3[2] * x + beta_hat_3[3] * (x - 4)^2),
from = min(x), to = max(x), n = 101, add = TRUE, col = "green", lwd = 2)
curve(beta_hat_5[1] + beta_hat_5[2] * x + beta_hat_5[3] * x^2,
from = min(x), to = max(x), n = 101, add = TRUE, col = "lightblue", lwd = 2)
legend("topright",
legend = c("관측치", "1차-1차 회귀모형", "1차-2차 회귀모형", "2차 회귀모형"),
col = c("black", "blue", "green", "lightblue"),
pch = c(19, NA, NA, NA),
lty = c(NA, 1, 1, 1),
lwd = c(NA, 2, 2, 2),
bty = "n")
plot(x, y, xlab = "나이", ylab = "y(키와 몸무게의 비kg/cm)", cex = 0.5, pch = 19)
# 접합점 전 구간: x < 4
x_min <- min(x)    # 예: 1
x_knot <- 4
y_min <- beta_hat_2[1] + beta_hat_2[2] * x_min
y_knot <- beta_hat_2[1] + beta_hat_2[2] * x_knot
segments(x_min, y_min, x_knot, y_knot, col = "blue", lwd = 2)
# 접합점 후 구간: x >= 4
x_max <- max(x)    # 예: 10
# x>=4인 구간의 회귀식은 y = beta_hat_2[1] + beta_hat_2[2]*x + beta_hat_2[3]*(x - 4)
y_knot2 <- beta_hat_2[1] + beta_hat_2[2] * x_knot  # x=4에서의 y값 (두 식이 같아야 함)
y_max <- beta_hat_2[1] + beta_hat_2[2] * x_max + beta_hat_2[3] * (x_max - 4)
segments(x_knot, y_knot2, x_max, y_max, col = "blue", lwd = 2)
curve(ifelse(x < 4,
beta_hat_3[1] + beta_hat_3[2] * x,
beta_hat_3[1] + beta_hat_3[2] * x + beta_hat_3[3] * (x - 4)^2),
from = min(x), to = max(x), n = 101, add = TRUE, col = "green", lwd = 2)
curve(beta_hat_5[1] + beta_hat_5[2] * x + beta_hat_5[3] * x^2,
from = min(x), to = max(x), n = 101, add = TRUE, col = "lightblue", lwd = 2)
legend("bottomright",
legend = c("관측치", "1차-1차 회귀모형", "1차-2차 회귀모형", "2차 회귀모형"),
col = c("black", "blue", "green", "lightblue"),
pch = c(19, NA, NA, NA),
lty = c(NA, 1, 1, 1),
lwd = c(NA, 2, 2, 2),
bty = "n")
plot(x, y, xlab = "나이", ylab = "y(키와 몸무게의 비kg/cm)",
main = "다항회귀모형", cex = 0.5, pch = 19)
# 접합점 전 구간: x < 4
x_min <- min(x)    # 예: 1
x_knot <- 4
y_min <- beta_hat_2[1] + beta_hat_2[2] * x_min
y_knot <- beta_hat_2[1] + beta_hat_2[2] * x_knot
segments(x_min, y_min, x_knot, y_knot, col = "blue", lwd = 2)
# 접합점 후 구간: x >= 4
x_max <- max(x)    # 예: 10
# x>=4인 구간의 회귀식은 y = beta_hat_2[1] + beta_hat_2[2]*x + beta_hat_2[3]*(x - 4)
y_knot2 <- beta_hat_2[1] + beta_hat_2[2] * x_knot  # x=4에서의 y값 (두 식이 같아야 함)
y_max <- beta_hat_2[1] + beta_hat_2[2] * x_max + beta_hat_2[3] * (x_max - 4)
segments(x_knot, y_knot2, x_max, y_max, col = "blue", lwd = 2)
curve(ifelse(x < 4,
beta_hat_3[1] + beta_hat_3[2] * x,
beta_hat_3[1] + beta_hat_3[2] * x + beta_hat_3[3] * (x - 4)^2),
from = min(x), to = max(x), n = 101, add = TRUE, col = "green", lwd = 2)
curve(beta_hat_5[1] + beta_hat_5[2] * x + beta_hat_5[3] * x^2,
from = min(x), to = max(x), n = 101, add = TRUE, col = "lightblue", lwd = 2)
legend("bottomright",
legend = c("관측치", "1차-1차 회귀모형", "1차-2차 회귀모형", "2차 회귀모형"),
col = c("black", "blue", "green", "lightblue"),
pch = c(19, NA, NA, NA),
lty = c(NA, 1, 1, 1),
lwd = c(NA, 2, 2, 2),
bty = "n")
library(ISLR)
data(Auto)
library(ISLR)
library(dplyr)
data(Auto)
dataset  = Auto %>% na.omit %>% select(horsepower,mpg)
dataset
library(ISLR)
library(dplyr)
data(Auto)
dataset  = Auto %>% na.omit %>% select(horsepower,mpg)
x = dataset$horsepower ; y = dataset$mpg
X = cbind(x);
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
x2 = x^2
X = cbind(x, x2);
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
knitr::opts_chunk$set(echo = TRUE)
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("C:/Users/PC/self_study/adv_reg/functions/reg_diagnostics.R", echo=TRUE)
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
library(dplyr)
library(ISLR)
data(Hitters)
hitter.dat <- Hitters %>% na.omit %>% select(Salary, AtBat, Hits, HmRun)
lm.fit <- lm(Salary ~., hitter.dat)
res <- rstudent(lm.fit) # 스튜던트화 잔차
res [abs(res) > qt(0.975, 258)]
summary(influence.measures(lm.fit))
summary(influence.measures(lm.fit))
X <- as.matrix(hitter.dat[, -1])
# 잔차
res <- lm.fit$residuals
# 잔차의 자유도 : n - p - 1
df.res <- lm.fit$df.residual
# MSE의 제곱근
s <- as.vector(sqrt(res %*% res) / df.res)
# 해트행렬
hat.mat <- X %*% solve(t(X) %*% X) %*% t(X)
# 표준화 잔차
standard_res <- res / (s * sqrt(1 - diag(hat.mat)))
# 스튜던트화 잔차
student_res <- standard_res * sqrt((df.res - 1) / (df.res - standard_res^2))
# 이상점
outlier <- rownames(hitter.dat)[(abs(student_res) > qt(0.025, df = df.res - 1, lower.tail = FALSE)) == TRUE]
outlier
X <- as.matrix(hitter.dat[, -1])
# 잔차
res <- lm.fit$residuals
# 잔차의 자유도 : n - p - 1
df.res <- lm.fit$df.residual
# MSE의 제곱근
s <- as.vector(sqrt(res %*% res) / df.res)
# 해트행렬
hat.mat <- X %*% solve(t(X) %*% X) %*% t(X)
# 표준화 잔차
standard_res <- res / (s * sqrt(1 - diag(hat.mat)))
# 스튜던트화 잔차
student_res <- standard_res * sqrt((df.res - 1) / (df.res - standard_res^2))
# 이상점
outlier <- rownames(hitter.dat)[(abs(student_res) > qt(0.975, df = df.res - 1)) == TRUE]
outlier
X <- as.matrix(hitter.dat[, -1])
# 잔차
res <- lm.fit$residuals
# 잔차의 자유도 : n - p - 1
df.res <- lm.fit$df.residual
# MSE의 제곱근
s <- as.vector(sqrt(res %*% res / df.res) )
# 해트행렬
hat.mat <- X %*% solve(t(X) %*% X) %*% t(X)
# 표준화 잔차
standard_res <- res / (s * sqrt(1 - diag(hat.mat)))
# 스튜던트화 잔차
student_res <- standard_res * sqrt((df.res - 1) / (df.res - standard_res^2))
# 이상점
outlier <- rownames(hitter.dat)[(abs(student_res) > qt(0.975, df = df.res - 1)) == TRUE]
outlier
yhat_outlier = lm.fit$fitted.values[outlier]
student_res_outlier = student_res[outlier]
par(mfrow = c(1,2))
plot(lm.fit$fitted.values, standard_res, xlab = expression(hat(y)),
ylab = "Standardized Residual")
abline(h = c(-2, 2), col = "blue", lty = "dotted")
plot(lm.fit$fitted.values, student_res, xlab = expression(hat(y)),
ylab = "Studentized Residual")
abline(h = qt(c(0.025, 0.975), df = df.res - 1), col = "blue", lty = "dotted")
points(yhat_outlier, student_res_outlier, col = "red")
text(x = yhat_outlier, y = student_res_outlier, labels = outlier,
pos = 4, cex = 0.5, col = "red")
D = diag(hat.mat) * standard_res^2 / 4 * (1 - diag(hat.mat))
influence_obs <- hitter.dat$index[D > qf(0.5, 4, df.res)]
influence_obs
knitr::opts_chunk$set(echo = TRUE)
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
library(dplyr)
library(ISLR)
data(Hitters)
hitter.dat <- Hitters %>% na.omit %>% select(Salary, AtBat, Hits, HmRun)
lm.fit <- lm(Salary ~., hitter.dat)
res <- rstudent(lm.fit) # 스튜던트화 잔차
res [abs(res) > qt(0.975, 258)]
summary(influence.measures(lm.fit))
X <- as.matrix(hitter.dat[, -1])
# 잔차
res <- lm.fit$residuals
# 잔차의 자유도 : n - p - 1
df.res <- lm.fit$df.residual
# MSE의 제곱근
s <- as.vector(sqrt(res %*% res / df.res) )
# 해트행렬
hat.mat <- X %*% solve(t(X) %*% X) %*% t(X)
# 표준화 잔차
standard_res <- res / (s * sqrt(1 - diag(hat.mat)))
# 스튜던트화 잔차
student_res <- standard_res * sqrt((df.res - 1) / (df.res - standard_res^2))
# 이상점
outlier <- rownames(hitter.dat)[(abs(student_res) > qt(0.975, df = df.res - 1)) == TRUE]
outlier
yhat_outlier = lm.fit$fitted.values[outlier]
student_res_outlier = student_res[outlier]
par(mfrow = c(1,2))
plot(lm.fit$fitted.values, standard_res, xlab = expression(hat(y)),
ylab = "Standardized Residual")
abline(h = c(-2, 2), col = "blue", lty = "dotted")
plot(lm.fit$fitted.values, student_res, xlab = expression(hat(y)),
ylab = "Studentized Residual")
abline(h = qt(c(0.025, 0.975), df = df.res - 1), col = "blue", lty = "dotted")
points(yhat_outlier, student_res_outlier, col = "red")
text(x = yhat_outlier, y = student_res_outlier, labels = outlier,
pos = 4, cex = 0.5, col = "red")
D = diag(hat.mat) * standard_res^2 / 4 * (1 - diag(hat.mat))
influence_obs <- hitter.dat$index[D > qf(0.5, 4, df.res)]
influence_obs
x1 = c(28, 47, 39, 25, 34, 29, 38, 23, 52, 37, 35, 39, 38, 32, 25)
x2 = c(146, 169, 160, 156, 161, 168, 154, 153, 160, 152, 155, 154, 157, 162, 142)
x3 = c(34, 57, 38, 28, 37, 50, 54, 40, 62, 39, 46, 54, 57, 53, 32)
y = c(22, 36, 24, 22, 27, 29, 26, 23, 31, 25, 23, 27, 31, 25, 23)
X = cbind(x1, x2, x3) ; n = dim(X)[1] ; p = dim(X)[2]
x1 = c(28, 47, 39, 25, 34, 29, 38, 23, 52, 37, 35, 39, 38, 32, 25)
x2 = c(146, 169, 160, 156, 161, 168, 154, 153, 160, 152, 155, 154, 157, 162, 142)
x3 = c(34, 57, 38, 28, 37, 50, 54, 40, 62, 39, 46, 54, 57, 53, 32)
y = c(22, 36, 24, 22, 27, 29, 26, 23, 31, 25, 23, 27, 31, 25, 23)
X = cbind(x1, x2, x3) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
X = cbind(x1) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
X = cbind(x3) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
knitr::opts_chunk$set(echo = TRUE)
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
source("functions/mult_reg.R", echo = TRUE)
source("functions/reg_diagnostics.R", echo = TRUE)
x = c(15, 26, 10, 9, 15, 20, 18, 11, 8 ,20, 7, 9, 10, 11, 11, 10, 12, 42, 17, 11, 10)
y = c(95, 71, 83, 91, 102, 87, 93, 100, 104, 94, 113, 96, 83, 84, 102, 100, 105, 57, 121, 86, 100)
X = cbind(x)
mult_res = mult_reg(X, y, coeff = TRUE, alpha = 0.05)
beta_hat = mult_res$beta_hat ; beta_hat
MSE = mult_res$MSE ; MSE ;sqrt(MSE)
outlier_res = outliers(X, y, alpha = 0.05, MSE)
hbar = mean(outlier_res$h_ii) ; hbar
library(dplyr)
library(ISLR)
data(Hitters)
hitter.dat <- Hitters %>% na.omit %>% select(Salary, AtBat, Hits, HmRun)
lm.fit <- lm(Salary ~., hitter.dat)
res <- rstudent(lm.fit) # 스튜던트화 잔차
res [abs(res) > qt(0.975, 258)]
summary(influence.measures(lm.fit))
X <- as.matrix(hitter.dat[, -1])
# 잔차
res <- lm.fit$residuals
# 잔차의 자유도 : n - p - 1
df.res <- lm.fit$df.residual
# MSE의 제곱근
s <- as.vector(sqrt(res %*% res / df.res) )
# 해트행렬
hat.mat <- X %*% solve(t(X) %*% X) %*% t(X)
# 표준화 잔차
standard_res <- res / (s * sqrt(1 - diag(hat.mat)))
# 스튜던트화 잔차
student_res <- standard_res * sqrt((df.res - 1) / (df.res - standard_res^2))
# 이상점
outlier <- rownames(hitter.dat)[(abs(student_res) > qt(0.975, df = df.res - 1)) == TRUE]
outlier
yhat_outlier = lm.fit$fitted.values[outlier]
student_res_outlier = student_res[outlier]
par(mfrow = c(1,2))
plot(lm.fit$fitted.values, standard_res, xlab = expression(hat(y)),
ylab = "Standardized Residual")
abline(h = c(-2, 2), col = "blue", lty = "dotted")
plot(lm.fit$fitted.values, student_res, xlab = expression(hat(y)),
ylab = "Studentized Residual")
abline(h = qt(c(0.025, 0.975), df = df.res - 1), col = "blue", lty = "dotted")
points(yhat_outlier, student_res_outlier, col = "red")
text(x = yhat_outlier, y = student_res_outlier, labels = outlier,
pos = 4, cex = 0.5, col = "red")
D = diag(hat.mat) * standard_res^2 / 4 * (1 - diag(hat.mat))
influence_obs <- hitter.dat$index[D > qf(0.5, 4, df.res)]
influence_obs
x1 = c(28, 47, 39, 25, 34, 29, 38, 23, 52, 37, 35, 39, 38, 32, 25)
x2 = c(146, 169, 160, 156, 161, 168, 154, 153, 160, 152, 155, 154, 157, 162, 142)
x3 = c(34, 57, 38, 28, 37, 50, 54, 40, 62, 39, 46, 54, 57, 53, 32)
y = c(22, 36, 24, 22, 27, 29, 26, 23, 31, 25, 23, 27, 31, 25, 23)
X = cbind(x1, x2, x3) ; n = dim(X)[1] ; p = dim(X)[2]
X = cbind(x3) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
X = cbind(x1, x2, x3) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
x1 = c(4, 8, 9, 8, 8, 12, 6, 10, 6, 9)
x2 = c(4, 10, 8, 5, 10, 15, 8, 13, 5, 12)
y = c(9, 20, 22, 15, 17, 30, 18, 25, 10, 20)
X = cbind(x1) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
X = cbind(x1, x2) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
x = c(6.4,16.1,42.1,2.1,30.7,32.1,7.2,3.4,20.8,1.5)
y = c(1.7,2.7,4.9,0.3,3.9,4.1,1.2,0.5,3.3,0.2)
X = cbind(x1) ; n = dim(X)[1] ; p = dim(X)[2]
source("functions/reg_diagnostics.R", echo = T)
source("functions/mult_reg.R", echo = T)
mult_res = mult_reg(X, y, alpha = 0.05, coeff = TRUE)
MSE = mult_res$MSE
outliers(X, y, alpha = 0.05, MSE)
DFFITS_bound = 2 * sqrt((p+1) / n) ; DFFITS_bound
D_i_bound = qf(0.50, p+1, n-p-1, lower.tail = FALSE) ; D_i_bound
COVRAT_ubound = 1 + 3 * ((p+1) / n) ; COVRAT_ubound
COVRAT_lbound = 1 - 3 * ((p+1) / n) ; COVRAT_lbound
FVARAT_ubound = 1 + ((2 * p + 3)/n) ; FVARAT_ubound
FVARAT_lbound = 1 - (3/n) ; FVARAT_lbound
